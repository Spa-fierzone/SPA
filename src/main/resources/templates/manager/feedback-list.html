<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý Feedback - SpaZone</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    .feedback-card {
        border-left: 4px solid #fca9c5;
        transition: transform 0.2s;
    }
    .feedback-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .rating-stars {
        color: #ffc107;
        font-size: 1.1em;
    }
    .rating-category {
        font-size: 0.9em;
        margin-bottom: 0.25rem;
    }
    .anonymous-badge {
        background: linear-gradient(45deg, #6c757d, #495057);
    }
    .customer-name {
        font-weight: 600;
        color: #f2729f;
    }
    .feedback-date {
        color: #6c757d;
        font-size: 0.9em;
    }
    .comments-section {
        background-color: #f8f9fa;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-top: 0.5rem;
    }
    .header-section {
        background: linear-gradient(135deg, #ff6b9d 0%, #ff8fab 50%, #ffb3c6 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
    }
    .stats-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        text-align: center;
    }
    .stats-number {
        font-size: 2rem;
        font-weight: bold;
        color: #fca9c5;
    }
    .pagination-custom .page-link {
        border-radius: 50px;
        margin: 0 2px;
    }
    .pagination-custom .page-item.active .page-link {
        background: linear-gradient(135deg, #ff6b9d 0%, #ff8fab 50%, #ffb3c6 100%);
        border: none;
    }
    .rating-breakdown {
        font-size: 0.85em;
    }
    .rating-label {
        font-weight: 500;
        color: #495057;
    }
    .star-rating {
        display: inline-block;
        margin-left: 0.5rem;
    }
  </style>
</head>
<body class="bg-light">
<!-- Header Section -->
<div class="header-section">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="mb-2">
          <i class="fas fa-comments me-3"></i>
          Feedback Khách hàng
        </h1>
        <p class="mb-0 opacity-75">Theo dõi và quản lý phản hồi từ khách hàng về dịch vụ</p>
      </div>
      <div class="col-md-4">
        <div class="stats-card">
          <div class="stats-number" th:text="${totalElements}">0</div>
          <div class="text-muted">Tổng Feedback</div>
          <a th:href="@{/dashboard}" class="btn btn-outline-dark">← Về Dashboard</a>

        </div>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <!-- Filter and Search Section -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-search"></i></span>
        <input type="text" class="form-control" placeholder="Tìm kiếm theo tên khách hàng hoặc bình luận...">
      </div>
    </div>
    <div class="col-md-3">
      <select class="form-select">
        <option value="">Tất cả đánh giá</option>
        <option value="5">5 sao</option>
        <option value="4">4 sao</option>
        <option value="3">3 sao</option>
        <option value="2">2 sao</option>
        <option value="1">1 sao</option>
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select">
        <option value="">Sắp xếp theo</option>
        <option value="newest">Mới nhất</option>
        <option value="oldest">Cũ nhất</option>
        <option value="highest">Đánh giá cao nhất</option>
        <option value="lowest">Đánh giá thấp nhất</option>
      </select>
    </div>
  </div>

  <!-- Feedback List -->
  <div class="row">
    <!-- Kiểm tra nếu có feedback -->
    <div th:if="${feedbacks != null and !feedbacks.empty}">
      <div class="col-12" th:each="feedback : ${feedbacks}">
        <div class="card feedback-card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <span class="customer-name" th:text="${feedback.customerDisplayName}">Tên khách hàng</span>
              <span class="badge anonymous-badge ms-2" th:if="${feedback.isAnonymous}">
                <i class="fas fa-user-secret me-1"></i>Ẩn danh
              </span>
            </div>
            <div class="feedback-date">
              <i class="fas fa-calendar-alt me-1"></i>
              <span th:text="${#temporals.format(feedback.createdAt, 'dd/MM/yyyy HH:mm')}">Ngày tạo</span>
            </div>
          </div>

          <div class="card-body">
            <!-- Overall Rating -->
            <div class="row mb-3">
              <div class="col-md-6">
                <h6 class="mb-2">Đánh giá tổng thể</h6>
                <div class="d-flex align-items-center">
                  <span class="rating-stars star-rating">
                    <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                      <i class="fas fa-star" th:if="${i <= feedback.overallRating}"></i>
                      <i class="far fa-star" th:unless="${i <= feedback.overallRating}"></i>
                    </th:block>
                  </span>
                  <span class="ms-2 fw-bold" th:text="${feedback.overallRating + '/5'}">5/5</span>
                  <span class="ms-2 text-muted" th:text="'(Trung bình: ' + ${#numbers.formatDecimal(feedback.averageRating, 1, 1)} + ')'">
                    (Trung bình: 5.0)
                  </span>
                </div>
              </div>
              <div class="col-md-6">
                <small class="text-muted">
                  ID Cuộc hẹn: <span th:text="${feedback.appointmentId}">#123</span>
                </small>
              </div>
            </div>

            <!-- Rating Breakdown -->
            <div class="row rating-breakdown mb-3">
              <div class="col-md-3">
                <div class="rating-category">
                  <span class="rating-label">Dịch vụ:</span>
                  <span class="star-rating rating-stars">
                    <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                      <i class="fas fa-star" th:if="${i <= feedback.serviceRating}"></i>
                      <i class="far fa-star" th:unless="${i <= feedback.serviceRating}"></i>
                    </th:block>
                  </span>
                  <span th:text="${feedback.serviceRating}">5</span>
                </div>
              </div>
              <div class="col-md-3">
                <div class="rating-category">
                  <span class="rating-label">Kỹ thuật viên:</span>
                  <span class="star-rating rating-stars">
                    <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                      <i class="fas fa-star" th:if="${i <= feedback.technicianRating}"></i>
                      <i class="far fa-star" th:unless="${i <= feedback.technicianRating}"></i>
                    </th:block>
                  </span>
                  <span th:text="${feedback.technicianRating}">5</span>
                </div>
              </div>
              <div class="col-md-3">
                <div class="rating-category">
                  <span class="rating-label">Cơ sở:</span>
                  <span class="star-rating rating-stars">
                    <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                      <i class="fas fa-star" th:if="${i <= feedback.facilityRating}"></i>
                      <i class="far fa-star" th:unless="${i <= feedback.facilityRating}"></i>
                    </th:block>
                  </span>
                  <span th:text="${feedback.facilityRating}">5</span>
                </div>
              </div>
              <div class="col-md-3">
                <div class="rating-category">
                  <span class="rating-label">Tổng thể:</span>
                  <span class="star-rating rating-stars">
                    <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                      <i class="fas fa-star" th:if="${i <= feedback.overallRating}"></i>
                      <i class="far fa-star" th:unless="${i <= feedback.overallRating}"></i>
                    </th:block>
                  </span>
                  <span th:text="${feedback.overallRating}">5</span>
                </div>
              </div>
            </div>

            <!-- Comments -->
            <div th:if="${feedback.comments != null and !feedback.comments.isEmpty()}">
              <h6 class="mb-2">Bình luận</h6>
              <div class="comments-section">
                <p class="mb-0" th:text="${feedback.comments}">
                  Nội dung bình luận từ khách hàng...
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Thông báo khi không có feedback -->
    <div th:if="${feedbacks == null or feedbacks.empty}" class="col-12">
      <div class="card">
        <div class="card-body text-center py-5">
          <i class="fas fa-comments fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">Chưa có feedback nào</h5>
          <p class="text-muted">Hiện tại chưa có phản hồi nào từ khách hàng.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="row" th:if="${feedbacks != null and !feedbacks.empty and totalPages > 1}">
    <div class="col-12">
      <nav aria-label="Feedback pagination">
        <ul class="pagination pagination-custom justify-content-center">
          <!-- Previous Page -->
          <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
            <a class="page-link"
               th:href="${currentPage > 0} ? @{/manager/feedback(page=${currentPage - 1}, size=${feedbackPage.size})} : '#'"
               tabindex="-1">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>

          <!-- Page Numbers -->
          <th:block th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
                    th:if="${pageNum >= (currentPage - 2) and pageNum <= (currentPage + 2)}">
            <li class="page-item" th:classappend="${pageNum == currentPage} ? 'active'">
              <a class="page-link"
                 th:href="@{/manager/feedback(page=${pageNum}, size=${feedbackPage.size})}"
                 th:text="${pageNum + 1}">1</a>
            </li>
          </th:block>

          <!-- Next Page -->
          <li class="page-item" th:classappend="${currentPage >= totalPages - 1} ? 'disabled'">
            <a class="page-link"
               th:href="${currentPage < totalPages - 1} ? @{/manager/feedback(page=${currentPage + 1}, size=${feedbackPage.size})} : '#'">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Pagination Info -->
      <div class="text-center mt-3">
        <small class="text-muted">
          Hiển thị <span th:text="${currentPage * feedbackPage.size + 1}">1</span> -
          <span th:text="${(currentPage + 1) * feedbackPage.size > totalElements ? totalElements : (currentPage + 1) * feedbackPage.size}">10</span>
          trong tổng số <span th:text="${totalElements}">50</span> feedback
        </small>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>